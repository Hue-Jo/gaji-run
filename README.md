# Runner's Map
위치 기반 러닝 메이트 매칭 (Runner’s Map) 백엔드 프로젝트 입니다.

# 사용 기술 스택
- Java(JDK 17)
- SpringBoot 3.3
- JPA
- Spring Security
- JWT
- Gradle
- DB : MySQL
- File Storage : AWS S3
- Gradle
- Git
- AWS EC2
- Spring Batch

## ERD
![ERD](doc/img/erd.png)

## 주요기능

1. 지도 내에서 달릴 경로 시각화

2. 러닝크루 모집 기능 제공 (다양한 조건 필터, 댓글 기능 제공)

3. 러닝기록 / 랭킹 데이터 제공

4. 인증샷 / 좋아요 기능 제공


### 1. 회원

- [회원 가입]

  - 이메일 (중복 불가)
  - 비밀번호 (소문자, 숫자, 특수문자 포함 8자 이상)
  - 닉네임 (중복 불가)
  - 성별

- [회원 탈퇴]

  - 마이페이지 내에서 가능
  - 비밀번호를 입력 후 탈퇴 가능

- [회원정보 조회]

  - 마이페이지 내에서 가능
  - 자신의 프로필사진, 닉네임, 이메일, 성별 확인 가능
  - 프로필 사진은 등록하지 않으면 기본 이미지 제공

- [회원정보 수정]

  - 마이페이지 내에서 가능
  - 닉네임, 비밀번호를 바꿀 수 있음
    - 둘 중 하나만 바꿔도 수정 가능

- [프로필 사진 등록/수정]

  - 프로필 사진을 등록하기 전에는 기본 이미지로 제공됨
  - 한번 프로필 사진을 등록하면 이후 활동하는 서비스 내에서 닉네임과 함께 프로필 사진이 함께 제공됨
  - AWS S3의 버킷 내에 업로드 되고 URL을 받아 처리됨

- [로그인]

  - 이메일, 비밀번호 입력
  - Access, Refresh 토큰 생성
  - 기존 Refresh 토큰이 있는 경우 업데이트, 없으면 새로 저장
    => 중복 로그인(기기 변동과 같은 상황)이나 로그인을 한 상태에서 서비스를 종료해도 다음 로그인이 유지되도록 함
  - Refresh 토큰으로 Access 토큰을 갱신하여 로그인이 유지되도록 함

- [로그아웃]
  - Refresh 토큰 삭제, SecurityContext 초기화

### 2. 모집글

- [모집글 등록]
	- 러닝 메이트를 직접 모집하여 원하는 메이트를 찾을 수 있는 기능
	- 러닝시작 장소를 좌표로 받아, 근거리에 있는 사용자들을 찾을 수 있음 
	- 제목, 내용, 제한 인원, 출발 시간, 거리, 예상 페이스, 경로, 성별 등 기입
	- 수정, 삭제 가능 
	- 모집글 참여, 시작, 종료, 강퇴 기능 제공 

- [모집글 조회]
	- 중심 좌표(위도, 경도) 위치 기준으로 최단 거리 기준 2km이내의 러닝 모집, 
		인증샷 정보를 제공
	- 최단 거리를 구하기 위해 하버 사인 공식 (Haversine Formula) 을 사용
	- 러닝 모집 글을 필터링 하여 조회 할 때 러닝 페이스, 거리, 제한 인원 등의 조건은 
		start ~ end 의 범위로 조회 
		
- [댓글]
	- 특정 모집글에 참여한 사용자만 댓글 조회, 작성, 수정, 삭제 가능
	- 조회
		- 사용자의 닉네임, 댓글내용, 생성일자, 프로필사진, 수정여부 조회 가능
		- 페이징처리 
	- 작성
		- 공백으로는 작성할 수 없으며 최소 1자, 최대 200자까지만 작성할 수 있음
	- 수정/삭제
		- 댓글 작성자만 가능 


### 3. 러닝 데이터 조회

- [러닝 조회]
	- 총 누적거리, 월별 러닝 추이 (총 달린 시간) 등을 그래프로 한눈에 볼 수 있는 기능 

### 4. 랭킹 

- [랭킹 데이터 집계]
	- Spring Batch 를 통해 데이터 집계
	- 스케줄러를 활용하여 매일 자정마다 1회 수행하며 데이터 집계
	- 러닝 기록 데이터를 조회하여 거리 / 시간에 대한 가중치를 부여하고 
		특정 거리 수를 초과하면 가중치를 추가 부여하여 점수를 부여

- [랭킹 조회]
	- 집계된 랭킹 점수의 상위 20명에 대해 랭킹을 조회
	
	
### 5. 인증샷 

- [업로드]

  - 모집글을 올린 그룹장만 업로드 가능
  - 러닝이 종료된 후에만 업로드 가능

- [조회]

  - 로그인 된 모든 이용자가 조회할 수 있음
  - 지도 화면 내에서 모집글과 함께 조회됨
  - 업로드된 지 3일 후 숨김처리됨
    - 사용자가 느끼기에 화면이 복잡하다는 느낌 최소화

- [좋아요]

  - 로그인 된 모든 이용자가 좋아요를 누를 수 있음
  - 토글 형식
    - 동일인이 동일 사진에 좋아요를 두 번 두를 시 좋아요가 취소됨
  - 낙관적 락을 사용하여 동시성 문제 해결
    - 일회성 매칭이므로 좋아요가 동시에 여러 개 눌릴 가능성이 낮다고 판단. 버전 관리로 락을 거는 방식이 효율적이라 생각
   
    
   
